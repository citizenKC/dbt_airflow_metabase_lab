## Учебный проект с использованием Docker, Airflow, Postgresql

## Краткое описание проекта:
В данном проекте с помощью `Airflow`, развёрнутом в `Docker`, происходит помесячная выгрузка данных **parquet** [файлов](https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page), содержащих информацию о поездках в жёлтых такси Нью-Йорка. Файлы загружаются в локальную БД Postgre.

## Для работы потребутеся установка следующих программ:
* Python
* DBeaver
* Docker 

## Начинаем работу:

1. Склонируйте репозиторий:

```
git clone https://github.com/citizenKC/airflow_project.git

```
2. В папке проекта создайте файл `.env`. Запустите следующую команду:

```
echo -e "AIRFLOW_UID=$(id -u)" >> .env

```
Далее, в этот файл добавьте данные для доступа к БД. `****` - заполняете сами:


```
#Логин и пароль должны совпадать
PG_USER= ****
PG_PASS= ****
PG_DB= ****
#Порт хост машины
PG_PORT= ****
#Порт в Docker'е
PG_PORT_2=****

```
Ваш заполненный `.env` файл может выглядеть следующим образом:

```

AIRFLOW_UID=100500
PG_USER=root
PG_PASS=root
PG_DB= ny_taxi
PG_PORT=5430
PG_PORT_2=5432

```


3. Соберите образ и запустите контейнеры последовательно выполнив следующие комманды:
```
docker-compose build

docker-compose up -d 
```
4. После успешного выполнения комманд в `Docker'e` можно увидеть информацию об активных контейнерах.

Если контейнеры исправно работают - откройте DBeaver, создайте подключение к базе с именем, логином и паролем которые вы указывали в `env` файле. Создайте таблицу используя код из файла `init.sql` (**Путь: airflow_project/sql/init.sql**)

5. В браузере зайдите в веб-интерфейс Airflow по ссылке: 

http://localhost:8080

Зайдите в `Airflow` введя следующие данные:
- **Логин**: airflow
- **Пароль**: airflow

Запустите DAG `IngestionDag`. В результате выполнения Дага в DBeaver должны выгрузится данные в таблицу, которую вы создали на предыдущем шаге. Таблица должна весить около 3 ГБ.  

6. Проверьте данные, выгруженные в таблицу. Создайте свои sql скрипты на основе sql скриптов (**avg_trip_cost** и **payments_type_cnt**), расположенных в папке `sql` вашего проекта; узнайте информацию о средней стоимости поездки и количестве платежей в разрезе типов платежей. 

